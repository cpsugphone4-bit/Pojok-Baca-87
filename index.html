<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>📚 Pojok Baca 87 — Kemendikbud (SIBI)</title>
<style>
:root{ --bg:#f8fafc; --fg:#0f172a; --card:#ffffff; --primary:#2563eb; --accent:#16a34a; --warn:#ea580c; }
*{box-sizing:border-box}
body{margin:0; font-family:system-ui, Arial, sans-serif; background:var(--bg); color:var(--fg);}
header{position:sticky; top:0; z-index:10; background:linear-gradient(90deg,var(--primary),var(--accent)); color:#fff; padding:14px 16px; display:flex; align-items:center; justify-content:space-between;}
header h1{margin:0; font-size:20px;}
.container{max-width:1100px; margin:0 auto; padding:16px;}
.card{background:var(--card); border-radius:14px; padding:16px; margin:16px 0; box-shadow:0 6px 18px rgba(0,0,0,.08);}
.controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
.input{flex:1; min-width:220px; padding:10px; border-radius:10px; border:1px solid #d1d5db; background:#fff;}
.btn{padding:9px 14px; border:none; border-radius:10px; cursor:pointer; font-weight:700; font-size:14px;}
.btn-primary{background:var(--primary); color:#fff;}
.btn-accent{background:var(--accent); color:#fff;}
.btn-secondary{background:#334155; color:#fff;}
.btn-warn{background:var(--warn); color:#fff;}
.badge{padding:2px 8px; border-radius:999px; background:#eef2ff; color:#1e3a8a; font-size:12px; margin-left:6px}
.results{max-height:360px; overflow:auto; border:1px solid #e5e7eb; border-radius:12px;}
.item{display:grid; grid-template-columns:72px 1fr auto; gap:12px; align-items:center; padding:10px; border-bottom:1px dashed #e5e7eb;}
.thumb{width:72px; height:96px; background:#f3f4f6; border-radius:8px; object-fit:cover; display:flex; align-items:center; justify-content:center; font-weight:700; color:#334155}
.viewer{width:100%; height:85vh; border:0; border-radius:12px; display:none; background:#000;}
.hidden{display:none;}
.gallery{display:flex; overflow-x:auto; gap:10px; scroll-snap-type:x mandatory}
.gallery img{height:160px; border-radius:12px; scroll-snap-align:center}
.kpis{display:flex; gap:12px; flex-wrap:wrap; margin-top:6px}
.kpi{background:#f1f5f9; border:1px solid #e2e8f0; border-radius:10px; padding:8px 10px; font-size:13px}
.small{font-size:12px; color:#6b7280}
</style>
</head>
<body>
<header>
  <h1>📚 Pojok Baca 87 <span class="badge">Kemendikbud (SIBI)</span></h1>
</header>

<div class="container">
  <section class="card">
    <h2>Cari Buku Kemendikbud (SIBI)</h2>
    <div class="controls">
      <input id="q" class="input" placeholder="Contoh: Matematika Kelas 7, Bahasa Indonesia, IPS, PKN"/>
      <button id="btnSearch" class="btn btn-accent">🔎 Cari</button>
    </div>
    <div class="kpis">
      <div id="kpiSIBI" class="kpi">Kemendikbud (PDF): 0</div>
    </div>
    <div id="results" class="results"></div>
    <h3 id="currentTitle">Viewer</h3>
    <iframe id="pdfFrame" class="viewer"></iframe>
  </section>

  <section class="card">
    <h2>⏱️ Timer Membaca</h2>
    <div class="controls">
      <span id="timer">00:00</span>
      <button id="startTimer" class="btn btn-primary">▶ Start</button>
      <button id="stopTimer" class="btn btn-secondary">⏹ Stop & Simpan</button>
    </div>
    <div class="small">Timer akan disimpan ke <b>Riwayat Membaca</b> ketika dihentikan.</div>
  </section>

  <section class="card">
    <h2>📝 Catatan</h2>
    <textarea id="notes" class="input" style="min-height:140px" placeholder="Tulis catatan bacamu di sini..."></textarea>
    <div class="small">Catatan tersimpan otomatis di perangkat (localStorage).</div>
  </section>

  <section class="card">
    <h2>📜 Riwayat Membaca</h2>
    <ul id="history"></ul>
    <button id="clearAll" class="btn btn-warn">🗑️ Hapus Semua Riwayat</button>
  </section>

  <section class="card">
    <h2>🖼️ Gallery</h2>
    <div class="gallery">
      <img src="https://i.postimg.cc/JhP0HkX2/20250819-123403.jpg" alt="gambar1"/>
      <img src="https://i.postimg.cc/tR1dyqQj/20250819-123536.jpg" alt="gambar2"/>
    </div>
  </section>
</div>

<script>
// Timer + Riwayat
let t=0, timerInt=null, currentBook="(Tanpa Judul)";
function showTime(){ const m=Math.floor(t/60), s=t%60; document.getElementById('timer').textContent=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0'); }
document.getElementById('startTimer').onclick=()=>{ if(!timerInt){ timerInt=setInterval(()=>{t++; showTime();},1000);} };
document.getElementById('stopTimer').onclick=()=>{
  if(timerInt){ clearInterval(timerInt); timerInt=null; }
  const now=new Date().toLocaleString('id-ID');
  const h=JSON.parse(localStorage.getItem('history87')||'[]');
  h.push({title:currentBook, dur:t, time:now});
  localStorage.setItem('history87', JSON.stringify(h));
  t=0; showTime(); renderHistory();
};
function renderHistory(){
  const h=JSON.parse(localStorage.getItem('history87')||'[]');
  document.getElementById('history').innerHTML = h.map((x,i)=>`<li>📖 ${x.title} — ${Math.floor(x.dur/60)} menit ${x.dur%60} detik (${x.time}) <button class="btn btn-warn" onclick="delHist(${i})">❌</button></li>`).join('');
}
function delHist(i){
  const h=JSON.parse(localStorage.getItem('history87')||'[]'); h.splice(i,1);
  localStorage.setItem('history87', JSON.stringify(h)); renderHistory();
}
document.getElementById('clearAll').onclick=()=>{ if(confirm('Hapus semua riwayat?')){ localStorage.removeItem('history87'); renderHistory(); } };
renderHistory();

// Notes autosave
const notesEl=document.getElementById('notes');
notesEl.value=localStorage.getItem('notes87')||'';
notesEl.oninput=()=>localStorage.setItem('notes87', notesEl.value);

// SIBI Search via serverless proxy (/api/sibi)
const q=document.getElementById('q'), results=document.getElementById('results'), pdfFrame=document.getElementById('pdfFrame');
document.getElementById('btnSearch').onclick=doSearch;
q.addEventListener('keydown',(e)=>{ if(e.key==='Enter') doSearch(); });
function hideViewer(){ pdfFrame.style.display='none'; }
function openPDF(url,title){
  currentBook=title||'(PDF Kemendikbud)';
  document.getElementById('currentTitle').textContent=currentBook;
  hideViewer();
  pdfFrame.src=url;
  pdfFrame.style.display='block';
}
async function doSearch(){
  const term=q.value.trim();
  if(!term){ results.innerHTML='Ketik sesuatu.'; return; }
  results.innerHTML='Mencari di Kemendikbud (SIBI)...';
  try{
    const r=await fetch('/api/sibi?q='+encodeURIComponent(term)).then(r=>r.json());
    const items=r.items||[];
    document.getElementById('kpiSIBI').textContent='Kemendikbud (PDF): '+items.length;
    results.innerHTML = items.map(it=>`
      <div class="item">
        <div class="thumb">PDF</div>
        <div><b>${it.title||'Buku Kemendikbud'}</b><br><span class="small">${new URL(it.url).hostname}</span></div>
        <div>
          <button class="btn btn-accent" onclick="openPDF('${it.url.replace(/'/g,'&#39;')}','${(it.title||'Buku Kemendikbud').replace(/'/g,'&#39;')}')">Baca</button>
          <a class="btn btn-primary" href="${it.url}" target="_blank">Buka</a>
        </div>
      </div>
    `).join('') || '❌ Tidak ada hasil PDF dari Kemendikbud untuk kata kunci itu. Coba kata lain (misal: "Matematika kelas 7" / "Sejarah Indonesia XI").';
  }catch(e){
    console.error(e);
    results.innerHTML='❌ Gagal mengambil hasil dari SIBI. Coba lagi.';
  }
}
</script>
</body>
</html>
